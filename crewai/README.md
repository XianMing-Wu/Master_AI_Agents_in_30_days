### Crew AI 概述

* **基本介绍**: 一个用于编排高性能人工智能代理的框架，与我们之前学习的 OpenAI 代理 SDK 有相似之处，但也存在新的术语和构造。
* **学习模式**: 学习过程中会不断接触并喜爱上新的框架，然后又会转向下一个，需要我们持续比较它们的异同、优劣，以便为不同项目选择最合适的框架。

### Crew AI 的三种不同产品

| 产品/服务                    | 描述                                                 | 主要目标用户/场景                                                  |
| :--------------------------- | :--------------------------------------------------- | :----------------------------------------------------------------- |
| **Crew AI Enterprise** | 一个用于部署、运行、监控和管理代理的企业级平台。     | 需要商业化部署和托管服务的用户。                                   |
| **Crew AI UI Studio**  | 一个用于组合代理交互的低代码/无代码平台。            | 终端用户或需要快速搭建代理流程而不想深入编码的人。                 |
| **开源框架**           | 一个用于轻松、大规模地编排高性能 AI 代理的开源工具。 | **本次学习的重点**，适合希望自行编写代码、构建代理的开发者。 |

### 开源框架的两种工作模式

* **Crews (团队模式)**:
  * **描述**: 拥有不同角色的代理团队协同工作的自主解决方案。
  * **适用场景**:
    * 自主解决问题
    * 创造性协作
    * 探索性任务
* **Flows (流程模式)**:
  * **描述**: 更具规定性的、步骤固定的工作流，可包含决策点和结果。
  * **适用场景**:
    * 需要确定性结果的场景
    * 要求可审计性的任务
    * 需要精确控制流程的场合
  * **推测**: 可能是为了解决 "Crews" 模式在生产环境中不确定性和可审计性不足的问题而推出的。

### Crew AI 的核心概念与构建模块

与 OpenAI Agents SDK 相比，Crew AI 的概念更具“规定性”或“固执性”（opinionated），提供了更具体的术语和结构。

#### 1. 三大核心概念

| 概念 (Concept)         | 描述 (Description)                                                                   | 核心组成 (Key Components)                                                                                                                                                         |
| :--------------------- | :----------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **代理 (Agent)** | 执行工作的最小自主单元，每个代理都与一个大语言模型（LLM）相关联。                    | **角色 (Role)**: 它的身份是什么。<br />**目标 (Goal)**: 它需要完成什么。<br />**背景故事 (Backstory)**: 它的背景和上下文。<br />内存 (Memory) 和 工具 (Tools)。 |
| **任务 (Task)**  | 分配给代理的具体作业。这是 Crew AI 特有的概念，在 OpenAI Agents SDK 中没有直接对应。 | **描述 (Description)**: 任务的具体内容。<br />**预期输出 (Expected Output)**: 任务完成时应有的结果。<br />**代理 (Agent)**: 负责执行此任务的代理。              |
| **团队 (Crew)**  | 由代理和任务组成的团队，是前两者的集合体                                             | **代理 (Agents)**: 团队中的所有代理。<br />**任务 (Tasks)**: 需要完成的所有任务。<br />**流程模式 (Process Modes)**。                                           |

#### 2. 团队 (Crew) 的两种流程模式

1. **顺序模式 (Sequential)**: 按照预设顺序，依次执行每一个任务。
2. **层级模式 (Hierarchical)**: 由一个“管理者”LLM 来决定任务的分配和执行顺序。

---

### 框架特性与实现方式

#### 1. 更“固执”的框架设计 (A More Opinionated Framework)

* **与 OpenAI 的对比**: OpenAI 代理只有一个宽泛的 `instruction`（指令），非常灵活。而 Crew AI 将其细化为 `role`、`goal` 和 `backstory`。
* **优点**: 这种结构强制用户遵循良好的提示工程实践，通过提供充足的上下文来提升代理性能。
* **缺点**: 灵活性较低。在某些不需要背景故事或需要不同提示结构的场景下，修改起来更困难。同时，由于最终的系统提示是自动合成的，调试起来也更复杂。

#### 2. 通过配置文件 (YAML) 进行定义

* **关注点分离 (Separation of Concerns)**: 你可以将代理 (Agents) 和任务 (Tasks) 的详细定义（如角色、目标、描述等）写入 YAML 配置文件中，而不是硬编码在 Python 代码里。
* **优点**:
  * 将提示文本与业务逻辑代码清晰地分离开来。
  * 便于独立地修改和管理提示内容。
* **代码实现**: 在代码中，你可以直接从 YAML 配置文件中加载这些定义来创建代理或任务实例，使代码更简洁。

#### 3. 核心文件 `crew.py` 与装饰器 (Decorators)

* **中心枢纽**: `crew.py` 是一个核心文件，用于定义和组织所有的代理、任务和最终的团队。
* **使用装饰器**: Crew AI 大量使用装饰器来简化定义过程：
  * `@crew_base`: 用于标记管理整个团队的主类。
  * `@agent`: 用于标记创建代理的函数。
  * `@task`: 用于标记创建任务的函数。
  * `@crew`: 用于标记最终组建并返回团队实例的函数。
* **工作机制**: 这些装饰器会自动将通过函数创建的代理和任务收集到实例变量中（如 `self.agents`），让你可以在最后一步轻松地将它们组装成一个完整的 `Crew`。

### 与大语言模型 (LLMs) 的交互

* **底层框架**: Crew AI 在底层使用一个名为 **LiteLLM** 的框架来与各种语言模型提供商进行交互。
* **核心优势**:
  * **极其灵活和轻量**: LiteLLM 的设计非常简洁，几乎没有多余的结构，使得连接到任何你能想到的 LLM 都变得非常简单。
  * **切换简便**: 你可以轻松地在项目中更换和测试不同的底层模型。
* **配置方式**:
  * 通过 `"提供商名称/模型名称"` 的格式来指定模型。
  * **示例**:
    * OpenAI: `"openai/gpt-4o-mini"`
    * Anthropic: `"anthropic/claude-3-5-sonnet-20240620"`
    * Google: `"google/gemini-1.5-flash"`
    * 本地模型: 使用 Olama 并提供基础 URL。
    * 其他服务: 如 Grok, OpenRouter 等也都支持。
* **对比优势**: 在与 LLM 交互的灵活性和简洁性方面，Crew AI 被认为比 OpenAI Agents SDK 更具优势。

---

### 项目结构与启动方式

与之前在 Notebook 中编写代码不同，Crew AI 推荐使用其命令行工具来创建和管理一个结构化的项目。

* **创建新项目**:
  * 使用命令 `crewai create crew <你的项目名>` 来创建一个新的 Crew AI 项目。
  * *(旁注: 也可以使用 `crewai create flow <项目名>` 来创建基于固定工作流的项目。)*
* **自动生成的项目结构**:
  * 该命令会生成一个包含预设目录和文件的项目脚手架。
  * **关键文件和目录**:
    * `<项目名>/`
      * `src/`
        * `<项目名>/`
          * `config/`: 存放 YAML 配置文件。
            * `agents.yaml`: 定义你的代理 (Agents)。
            * `tasks.yaml`: 定义你的任务 (Tasks)。
          * `crew.py`: **核心文件**，使用装饰器将所有代理和任务组装成最终的团队 (Crew)。
          * `main.py`: 项目的**入口文件**，用于启动和运行你的 Crew。
* **依赖管理**:
  * 创建的项目会自动设置为一个 **uv** 项目，包含了 `uv` 的项目配置文件。
* **运行项目**:
  * 使用命令 `crewai run` 来执行项目（该命令实际上会调用 `main.py` 文件）。


### 项目说明

