# 深度研究系统 - 渐进式学习计划

## 📚 学习目标

通过逐步构建的方式，将深度搜索系统与飞书集成，替换原有的邮件发送功能。

## 🎯 项目改造目标

- ✅ 保持原有 Multi-Agent 架构
- ✅ 将邮件发送替换为飞书卡片推送
- ✅ 每个任务独立可运行
- ✅ 层层递进，逐步增加复杂度

## 📋 任务列表

### 阶段一：飞书基础（Day 1-2）

#### Task 1: 飞书认证和基础消息 ⭐
**学习目标：** 理解飞书 API 认证流程和基础消息发送
- 获取 tenant_access_token
- 发送纯文本消息
- 错误处理和日志

**运行方式：**
```bash
python task1.py
```

#### Task 2: 飞书卡片设计 ⭐⭐
**学习目标：** 掌握飞书消息卡片 2.0 规范
- 创建研究报告卡片模板
- 支持 Markdown 内容渲染
- 添加交互按钮

**运行方式：**
```bash
python task2.py
```

### 阶段二：Agent 基础（Day 3-4）

#### Task 3: 单个 Agent 实现 ⭐⭐
**学习目标：** 理解 OpenAI Agent 框架基础
- 创建简单的搜索 Agent
- 使用 WebSearchTool
- 结构化输出

**运行方式：**
```bash
python task3.py "搜索 Python 最佳实践"
```

#### Task 4: 规划 Agent ⭐⭐⭐
**学习目标：** 实现搜索任务规划能力
- 分解复杂查询
- 生成多个搜索任务
- Pydantic 数据验证

**运行方式：**
```bash
python task4.py "人工智能在医疗领域的应用"
```

### 阶段三：搜索系统（Day 5-6）

#### Task 5: 并发搜索 ⭐⭐⭐
**学习目标：** 掌握异步编程和并发执行
- asyncio 基础
- 并发搜索执行
- 进度跟踪

**运行方式：**
```bash
python task5.py "量子计算最新进展"
```

#### Task 6: 搜索结果汇总 ⭐⭐⭐
**学习目标：** 数据整合和去重
- 合并多个搜索结果
- 提取关键信息
- 生成结构化数据

**运行方式：**
```bash
python task6.py
```

### 阶段四：报告生成（Day 7-8）

#### Task 7: 报告生成 Agent ⭐⭐⭐⭐
**学习目标：** 长文本生成和结构化
- 生成研究报告大纲
- Markdown 格式化
- 提取摘要和后续问题

**运行方式：**
```bash
python task7.py
```

### 阶段五：飞书集成（Day 9-10）

#### Task 8: 报告发送到飞书 ⭐⭐⭐⭐
**学习目标：** 整合搜索和飞书推送
- 报告转卡片格式
- 长文本分段处理
- 富文本渲染

**运行方式：**
```bash
python task8.py "区块链技术发展趋势"
```

#### Task 9: 完整流程整合 ⭐⭐⭐⭐⭐
**学习目标：** 端到端系统集成
- 规划 → 搜索 → 报告 → 推送
- 流式进度更新
- 完整错误处理

**运行方式：**
```bash
python task9.py "元宇宙的商业应用"
```

#### Task 10: Gradio UI + 优化 ⭐⭐⭐⭐⭐
**学习目标：** Web UI 和生产优化
- Gradio 界面集成
- 配置管理
- 日志和监控
- 成本控制

**运行方式：**
```bash
python task10.py   
```

## 🛠️ 环境配置

### 1. 安装依赖
```bash
cd learning_tasks
pip install -r requirements.txt
```

### 2. 配置环境变量
创建 `.env` 文件：
```bash
# OpenAI API
OPENAI_API_KEY=sk-...

# 飞书配置
APP_ID=cli_...
APP_SECRET=...
OPEN_ID=ou_...
```

### 3. 验证配置
```bash
python task1.py
```
运行首个任务确认依赖和凭证配置无误。

## 🧭 仓库贡献指南

### 项目结构与职责
- `learning_tasks/` 收录按难度递进的脚本（`task1.py`–`task10.py`），每次运行单个脚本即可完成对应练习。
- `quick_setup.py` 提供 `.env` 快速生成，可选使用并位于同级目录。
- `requirements.txt` 管理运行依赖；不再维护额外指南或测试脚本，所有注意事项集中在本 README。

### 构建、运行与调试
- `pip install -r requirements.txt` 安装基础依赖。
- `python learning_tasks/taskN.py` 运行指定任务，`N` 为 1-10。
- `python learning_tasks/quick_setup.py` 按提示生成 `.env`，适合初次配置。

### 编码风格
- 使用 Python 3.10+ 与 4 空格缩进，保持类型注解和清晰 docstring。
- 模块命名使用 snake_case（如 `task11_async.py`），类名采用 PascalCase，环境变量使用 UPPER_SNAKE_CASE。
- 公共工具或客户端逻辑请抽取复用，避免在任务脚本间重复粘贴。

### 测试与验证
- 当前仓库无独立自动化测试；提交前请手动运行受影响的 `taskN.py` 验证行为。
- 对需要外部请求的逻辑，可先以 mock 或占位数据离线调试，再切换真实凭证确认。

### 提交与评审
- 建议遵循 Conventional Commits（如 `feat: add task11 planner`、`fix: refresh auth token`）以便快速检索。
- 在提交或 PR 描述中说明涉及的任务与运行结果，必要时附运行命令与关键输出。
- 若关联外部需求或问题，请在正文引用链接或编号便于追溯。

### 环境与安全
- 请勿提交 `.env` 或任何机密凭证，可在 `.gitignore` 中保证忽略。
- 区分测试与生产密钥，若凭证泄露需立即更换并同步各环境。
- 分享日志或截图时仅保留 ID 前几位，避免暴露完整账号信息。

## 📖 学习建议

### 每个任务的学习流程

1. **阅读代码**（15分钟）
   - 理解任务目标
   - 查看关键函数
   - 识别核心概念

2. **运行测试**（10分钟）
   - 执行示例代码
   - 观察输出结果
   - 理解数据流

3. **修改实验**（30分钟）
   - 调整参数观察变化
   - 添加日志输出
   - 尝试边界情况

4. **独立实现**（45分钟）
   - 关闭参考代码
   - 从零实现核心功能
   - 对比差异

### 知识点索引

| 任务 | 核心知识点 |
|------|-----------|
| Task 1 | HTTP API, 认证流程, 错误处理 |
| Task 2 | JSON 数据结构, 卡片设计, UI/UX |
| Task 3 | OpenAI Agents, 工具使用, 结构化输出 |
| Task 4 | Pydantic, 查询分解, 提示工程 |
| Task 5 | asyncio, 并发模式, 进度跟踪 |
| Task 6 | 数据聚合, 去重算法, 摘要提取 |
| Task 7 | 长文本生成, Markdown, 内容组织 |
| Task 8 | 系统集成, 格式转换, 富文本 |
| Task 9 | 端到端流程, 状态管理, 异常恢复 |
| Task 10 | Web UI, 配置管理, 生产优化 |

## 🎓 进阶挑战

完成基础任务后，可以尝试：

1. **添加缓存层**（Redis）
   - 缓存搜索结果
   - 缓存 Agent 输出
   - TTL 管理

2. **实现会话管理**
   - 多轮对话
   - 上下文保持
   - 历史查询

3. **成本优化**
   - Token 使用统计
   - 模型选择策略
   - 批处理优化

4. **监控告警**
   - 性能指标采集
   - 错误率监控
   - 飞书告警推送

## 📚 参考资料

- [OpenAI Agents 文档](https://platform.openai.com/docs/guides/agents)
- [飞书开放平台](https://open.feishu.cn/document/)
- [asyncio 教程](https://docs.python.org/3/library/asyncio.html)
- [Pydantic 文档](https://docs.pydantic.dev/)

## ❓ 常见问题

### Q1: 任务报错怎么办？
查看 `logs/` 目录下的日志文件，大部分错误都有详细说明。

### Q2: 如何跳过某个任务？
每个任务都是独立的，但建议按顺序完成以获得最佳学习效果。

### Q3: 可以修改任务代码吗？
强烈建议！通过修改和实验是最好的学习方式。

### Q4: 需要多长时间完成？
- 有编程基础：2-3 天
- 无异步编程经验：4-5 天
- 深度理解：1-2 周

## 🎉 完成标志

完成所有任务后，你将能够：
- ✅ 独立构建 Multi-Agent 系统
- ✅ 熟练使用飞书 API
- ✅ 掌握异步编程模式
- ✅ 实现完整的搜索-报告-推送流程
- ✅ 优化生产环境代码

祝学习愉快！🚀
